(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,a(r.key),r)}}function a(t){var a=function(t,a){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,a||"default");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(t)}(t,"string");return"symbol"==e(a)?a:a+""}!function(){"use strict";var e=function(){return e=function e(t){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=t,this.id=t.id,this.config=(null===(a=window.mortgageCalculatorConfig)||void 0===a?void 0:a[this.id])||{},this.currency=this.config.currency||"$",this.primaryColor=this.config.primaryColor||"#e31837",this.showExtraCosts=this.config.showExtraCosts||!1,this.translations=this.config.translations||{},this.isRtl=t.classList.contains("mortgage-calculator--rtl")||"rtl"===document.dir,this.defaultDownPaymentType=this.config.defaultDownPaymentType||"percent",this.defaultDownPaymentValue=this.config.defaultDownPaymentValue||20,this.form=t.querySelector("form"),this.errorContainer=t.querySelector("[data-error]"),this.modal=t.querySelector("[data-modal]"),this.debounceTimer=null,this.debounceDelay=150,this.hasUserInteracted=!1,this.calculationMethod="decreasing",this.chart=null,this.schedule=[],this.loanAmount=0,this.totalInterest=0,this.init()},a=[{key:"init",value:function(){this.attachEventListeners(),this.initNumberFormatting(),this.initPriceFromProperty(),this.initDownPayment(),this.syncLoanAmountFromSlider(),this.calculate()}},{key:"initPriceFromProperty",value:function(){var e,t=this.element.querySelector('[name="property_price"]');if(t&&t.hasAttribute("data-price-from")){var a=null===(e=document.querySelector("[data-property-price]"))||void 0===e?void 0:e.dataset.propertyPrice;a&&!isNaN(parseFloat(a))&&(t.value=this.formatNumber(parseFloat(a)))}}},{key:"initDownPayment",value:function(){if("amount"===this.defaultDownPaymentType){var e=this.element.querySelector('[name="property_price"]'),t=this.element.querySelector('[name="loan_percent"]');if(e&&t){var a=this.parseNumber(e.value);if(a>0){var n=this.defaultDownPaymentValue/a*100,r=Math.max(0,Math.min(100,100-n));t.value=r;var i=this.element.querySelector("[data-loan-percent]");i&&(i.textContent=Math.round(r)+"%"),this.updateSliderFill(t,r)}}}}},{key:"attachEventListeners",value:function(){var e=this;this.element.querySelectorAll("[data-calculate]").forEach(function(t){t.addEventListener("input",function(){e.hasUserInteracted=!0,"range"===t.type&&e.syncLoanAmountFromSlider(),e.debouncedCalculate()}),t.addEventListener("change",function(){e.hasUserInteracted=!0,e.calculate()})});var t=this.element.querySelector('[name="loan_amount"]');t&&t.addEventListener("input",function(){e.hasUserInteracted=!0,e.syncSliderFromLoanAmount(),e.debouncedCalculate()});var a=this.element.querySelector('[name="property_price"]');a&&a.addEventListener("input",function(){e.hasUserInteracted=!0,e.syncLoanAmountFromSlider(),e.debouncedCalculate()}),this.element.querySelectorAll("[data-method]").forEach(function(t){t.addEventListener("click",function(){return e.switchCalculationMethod(t)})});var n=this.element.querySelector("[data-toggle-details]");n&&n.addEventListener("click",function(){return e.openModal()}),this.element.querySelectorAll("[data-modal-close]").forEach(function(t){t.addEventListener("click",function(){return e.closeModal()})}),this.element.querySelectorAll("[data-view]").forEach(function(t){t.addEventListener("click",function(){return e.switchModalView(t)})}),document.addEventListener("keydown",function(t){"Escape"===t.key&&e.modal&&e.modal.classList.contains("is-open")&&e.closeModal()})}},{key:"initNumberFormatting",value:function(){var e=this;this.element.querySelectorAll("[data-format-number]").forEach(function(t){if(t.value){var a=e.parseNumber(t.value);a>0&&(t.value=e.formatNumber(a))}t.addEventListener("input",function(t){var a=t.target.selectionStart,n=t.target.value.length,r=e.parseNumber(t.target.value);!isNaN(r)&&r>=0&&(t.target.value=r>0?e.formatNumber(r):"");var i=t.target.value.length-n;t.target.setSelectionRange(a+i,a+i)}),t.addEventListener("focus",function(e){setTimeout(function(){return e.target.select()},0)})})}},{key:"parseNumber",value:function(e){return"number"==typeof e?e:parseFloat(String(e).replace(/[,.\s]/g,""))||0}},{key:"formatNumber",value:function(e){return"number"!=typeof e||isNaN(e)?"0":new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(Math.round(e))}},{key:"syncLoanAmountFromSlider",value:function(){var e=this.element.querySelector('[name="loan_percent"]'),t=this.element.querySelector('[name="loan_amount"]'),a=this.element.querySelector('[name="property_price"]'),n=this.element.querySelector("[data-loan-percent]");if(e&&t&&a){var r=this.parseNumber(a.value),i=parseFloat(e.value)||0,o=Math.round(r*i/100);t.value=o>0?this.formatNumber(o):"",n&&(n.textContent=i+"%"),this.updateSliderFill(e,i)}}},{key:"syncSliderFromLoanAmount",value:function(){var e=this.element.querySelector('[name="loan_percent"]'),t=this.element.querySelector('[name="loan_amount"]'),a=this.element.querySelector('[name="property_price"]'),n=this.element.querySelector("[data-loan-percent]");if(e&&t&&a){var r=this.parseNumber(a.value),i=this.parseNumber(t.value);if(r>0){var o=Math.min(100,Math.max(0,Math.round(i/r*100)));e.value=o,n&&(n.textContent=o+"%"),this.updateSliderFill(e,o)}}}},{key:"updateSliderFill",value:function(e,t){var a=t+"%",n=this.primaryColor,r=this.isRtl?"to left":"to right";e.style.background="linear-gradient(".concat(r,", ").concat(n," 0%, ").concat(n," ").concat(a,", #e0e0e0 ").concat(a,", #e0e0e0 100%)")}},{key:"switchCalculationMethod",value:function(e){var t=e.dataset.method;this.calculationMethod=t;var a=this.element.querySelector('[name="calculation_method"]');a&&(a.value=t),this.element.querySelectorAll("[data-method]").forEach(function(e){e.classList.toggle("mortgage-calculator__tab--active",e.dataset.method===t)}),this.calculate()}},{key:"debouncedCalculate",value:function(){var e=this;clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(function(){return e.calculate()},this.debounceDelay)}},{key:"getValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=this.element.querySelector('[name="'.concat(e,'"]'));if(!a)return t;if(a.hasAttribute("data-format-number"))return this.parseNumber(a.value);var n=parseFloat(a.value);return isNaN(n)?t:n}},{key:"validate",value:function(){var e=[],t=this.getValue("property_price"),a=this.getValue("loan_amount"),n=this.getValue("loan_term_months"),r=this.getValue("interest_rate");return t<=0&&e.push(this.translations.errorPropertyPrice||"Property price must be greater than 0"),a<=0&&e.push(this.translations.errorLoanAmount||"Loan amount must be greater than 0"),a>t&&e.push(this.translations.errorLoanExceedsPrice||"Loan amount cannot exceed property price"),n<=0&&e.push(this.translations.errorLoanTerm||"Loan term must be greater than 0"),r<0&&e.push(this.translations.errorInterestRate||"Interest rate cannot be negative"),e}},{key:"calculate",value:function(){var e=this.validate();if(e.length>0)return this.hasUserInteracted&&this.showError(e[0]),void this.showEmptyState();this.hideError(),this.showResults(),this.loanAmount=this.getValue("loan_amount");var t,a,n,r,i,o=this.getValue("loan_term_months"),l=this.getValue("interest_rate")/100/12;"decreasing"===this.calculationMethod?(this.schedule=this.calculateDecreasingBalance(this.loanAmount,l,o),a=(null===(n=this.schedule[0])||void 0===n?void 0:n.payment)||0,t=(null===(r=this.schedule[this.schedule.length-1])||void 0===r?void 0:r.payment)||0):(this.schedule=this.calculateFixedPayment(this.loanAmount,l,o),t=a=(null===(i=this.schedule[0])||void 0===i?void 0:i.payment)||0),this.totalInterest=this.schedule.reduce(function(e,t){return e+t.interest},0);var s=this.element.querySelector("[data-result-range]"),u=this.element.querySelector("[data-result-single]"),c=this.element.querySelector("[data-toggle-details]");"fixed"===this.calculationMethod?(s&&(s.style.display="none"),u&&(u.style.display="block"),c&&(c.style.display="none"),this.updateResultText("monthly-fixed",t)):(s&&(s.style.display="flex"),u&&(u.style.display="none"),c&&(c.style.display="inline-flex"),this.updateResultText("monthly-min",t),this.updateResultText("monthly-max",a)),this.updateResultText("total-interest",this.totalInterest)}},{key:"calculateDecreasingBalance",value:function(e,t,a){for(var n=[],r=e/a,i=e,o=1;o<=a;o++){var l=i*t,s=r+l;i=Math.max(0,i-r),n.push({period:o,payment:s,principal:r,interest:l,balance:i})}return n}},{key:"calculateFixedPayment",value:function(e,t,a){var n,r=[],i=e;if(0===t)n=e/a;else{var o=Math.pow(1+t,a);n=e*o*t/(o-1)}for(var l=1;l<=a;l++){var s=i*t,u=n-s;i=Math.max(0,i-u),r.push({period:l,payment:n,principal:u,interest:s,balance:i})}return r}},{key:"openModal",value:function(){var e=this;this.modal&&0!==this.schedule.length&&(this.updateStat("loan-amount",this.loanAmount),this.updateStat("total-interest",this.totalInterest),this.updateStat("total-paid",this.loanAmount+this.totalInterest),this.updateScheduleTable(this.schedule),this.modal.classList.add("is-open"),document.body.style.overflow="hidden",setTimeout(function(){return e.renderChart()},100))}},{key:"closeModal",value:function(){this.modal&&(this.modal.classList.remove("is-open"),document.body.style.overflow="")}},{key:"switchModalView",value:function(e){var t=this,a=e.dataset.view;this.element.querySelectorAll("[data-view]").forEach(function(e){e.classList.toggle("mortgage-calculator__modal-tab--active",e.dataset.view===a)});var n=this.element.querySelector("[data-chart-container]"),r=this.element.querySelector("[data-table-container]");n&&(n.style.display="chart"===a?"block":"none"),r&&(r.style.display="table"===a?"block":"none"),"chart"===a&&setTimeout(function(){return t.renderChart()},100)}},{key:"updateStat",value:function(e,t){var a=this.element.querySelector('[data-stat="'.concat(e,'"]'));a&&(a.textContent=this.formatCurrency(t))}},{key:"updateScheduleTable",value:function(e){var t=this,a=this.element.querySelector("[data-schedule-body]");a&&(a.innerHTML=e.map(function(e){return"\n                <tr>\n                    <td>".concat(e.period,"</td>\n                    <td>").concat(t.formatCurrency(e.payment),"</td>\n                    <td>").concat(t.formatCurrency(e.principal),"</td>\n                    <td>").concat(t.formatCurrency(e.interest),"</td>\n                    <td>").concat(t.formatCurrency(e.balance),"</td>\n                </tr>\n            ")}).join(""))}},{key:"renderChart",value:function(){var e=this,t=this.element.querySelector("[data-chart-canvas]");t&&0!==this.schedule.length&&("undefined"!=typeof Chart?this.createChart(t):this.loadChartJS().then(function(){return e.createChart(t)}))}},{key:"loadChartJS",value:function(){return new Promise(function(e,t){if("undefined"==typeof Chart){var a=document.createElement("script");a.src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js",a.onload=e,a.onerror=t,document.head.appendChild(a)}else e()})}},{key:"createChart",value:function(e){var t=this;this.chart&&this.chart.destroy();var a=this.groupByYear(this.schedule),n=e.getContext("2d"),r=a.map(function(e){return t.translations.year?"".concat(t.translations.year," ").concat(e.year):"Year ".concat(e.year)}),i=a.map(function(e){return e.principal}),o=a.map(function(e){return e.interest});this.chart=new Chart(n,{type:"bar",data:{labels:r,datasets:[{label:this.translations.principal||"Principal",data:i,backgroundColor:"#198754",borderColor:"#198754",borderWidth:1},{label:this.translations.interest||"Interest",data:o,backgroundColor:"#e31837",borderColor:"#e31837",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{padding:20,usePointStyle:!0}},tooltip:{callbacks:{label:function(e){return e.dataset.label+": "+t.formatCurrency(e.raw)}}}},scales:{x:{stacked:!0,grid:{display:!1}},y:{stacked:!0,ticks:{callback:function(e){return t.formatCurrency(e)}}}}}})}},{key:"groupByYear",value:function(e){var t=[],a=1,n=0,r=0;return e.forEach(function(i,o){n+=i.principal,r+=i.interest,(o+1)%12!=0&&o!==e.length-1||(t.push({year:a,principal:n,interest:r}),a++,n=0,r=0)}),t}},{key:"updateResultText",value:function(e,t){var a=this.element.querySelector('[data-result="'.concat(e,'"]'));a&&(a.textContent=this.formatCurrency(t))}},{key:"clearResults",value:function(){this.updateResultText("monthly-min",0),this.updateResultText("monthly-max",0),this.updateResultText("monthly-fixed",0),this.updateResultText("total-interest",0)}},{key:"showEmptyState",value:function(){var e=this.element.querySelector("[data-empty-state]"),t=this.element.querySelector("[data-results-display]");e&&(e.style.display="block"),t&&(t.style.display="none"),this.clearResults()}},{key:"showResults",value:function(){var e=this.element.querySelector("[data-empty-state]"),t=this.element.querySelector("[data-results-display]");e&&(e.style.display="none"),t&&(t.style.display="block")}},{key:"formatCurrency",value:function(e){return("number"!=typeof e||isNaN(e))&&(e=0),new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(Math.round(e))+" "+this.currency}},{key:"showError",value:function(e){this.errorContainer&&(this.errorContainer.textContent=e,this.errorContainer.style.display="block")}},{key:"hideError",value:function(){this.errorContainer&&(this.errorContainer.textContent="",this.errorContainer.style.display="none")}}],a&&t(e.prototype,a),n&&t(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,a,n}();function a(){document.querySelectorAll("[data-calculator]").forEach(function(t){t._mortgageCalculator||(t._mortgageCalculator=new e(t))})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",a):a(),window.initMortgageCalculators=a,window.MortgageCalculator=e}()})();